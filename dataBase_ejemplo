DROP TABLE IF EXISTS order_items;
DROP TABLE IF EXISTS orders;
DROP TABLE IF EXISTS products;
DROP TABLE IF EXISTS users;



CREATE TABLE users (
    id UUID PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);


CREATE TABLE products (
    id UUID PRIMARY KEY,
    name VARCHAR(200) NOT NULL,
    price DECIMAL(10, 2) NOT NULL,
    category VARCHAR(50),
    active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);


CREATE TABLE orders (
    id UUID PRIMARY KEY,
    user_id UUID,
    order_date DATE NOT NULL,
    total DECIMAL(12, 2) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

  
CREATE TABLE order_items (
    id UUID primary key DEFAULT gen_random_uuid(),
    order_id UUID,
    product_id UUID,
    quantity INTEGER NOT NULL,
    unit_price DECIMAL(10, 2) NOT NULL,
    FOREIGN KEY (order_id) REFERENCES orders(id),
    FOREIGN KEY (product_id) REFERENCES products(id)
);



INSERT INTO users (id, name, email) VALUES
('5d13be14-bc74-49fe-9b26-1fbcfe15243a', 'Ana García', 'ana.garcia@email.com'),
('ad5e4b9a-68a9-40b3-8ee1-8745da1af7b9', 'Carlos Mendoza', 'carlos.mendoza@email.com'),
('9e6bbb50-d8d3-4ac3-80f2-8cd719b2cab1', 'María López', 'maria.lopez@email.com'),
('7f8e9d10-4c5b-4a3d-9e2f-1a2b3c4d5e6f', 'Pedro Ramírez', 'pedro.ramirez@email.com'),
('8a9b0c11-5d6e-4b4f-0f3a-2b3c4d5e6f7a', 'Lucía Fernández', 'lucia.fernandez@email.com'),
('9b0c1d12-6e7f-4c5a-1a4b-3c4d5e6f7a8b', 'Jorge Torres', 'jorge.torres@email.com'),
('0c1d2e13-7f8a-4d6b-2b5c-4d5e6f7a8b9c', 'Sofía Ruiz', 'sofia.ruiz@email.com'),
('1d2e3f14-8a9b-4e7c-3c6d-5e6f7a8b9c0d', 'Miguel Ángel Castro', 'miguel.castro@email.com');




INSERT INTO products (id, name, price, category, active) VALUES
('f660296f-5582-4d8a-b8d5-f3e3250e9e6e', 'Laptop Dell XPS 15', 3500000.00, 'Electronics', TRUE),
('469f9f98-8905-4ea6-8f58-cb94ed5cdb69', 'iPhone 15 Pro', 900000.00, 'Electronics', TRUE),
('5cb3e058-1336-47a5-bf79-585742de7db7', 'Mouse Logitech MX', 50000.00, 'Accessories', TRUE),
('97068931-4d44-4fe8-a2fe-6351e135dc3c', 'Keyboard Mechanical', 120000.00, 'Accessories', TRUE),
('e557ec40-55d4-485e-8d2b-b051d5c26d3b', 'Monitor Samsung 27"', 150000.00, 'Electronics', TRUE),
('a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d', 'Webcam Logitech C920', 80000.00, 'Accessories', TRUE),
('b2c3d4e5-f6a7-4b8c-9d0e-1f2a3b4c5d6e', 'Headphones Sony WH-1000XM5', 250000.00, 'Audio', TRUE),
('c3d4e5f6-a7b8-4c9d-0e1f-2a3b4c5d6e7f', 'Tablet iPad Air', 550000.00, 'Electronics', TRUE),
('d4e5f6a7-b8c9-4d0e-1f2a-3b4c5d6e7f8a', 'Printer HP LaserJet', 200000.00, 'Office', TRUE),
('e5f6a7b8-c9d0-4e1f-2a3b-4c5d6e7f8a9b', 'Router TP-Link AC1750', 60000.00, 'Networking', TRUE),
('f6a7b8c9-d0e1-4f2a-3b4c-5d6e7f8a9b0c', 'SSD Samsung 1TB', 95000.00, 'Storage', TRUE),
('a7b8c9d0-e1f2-4a3b-4c5d-6e7f8a9b0c1d', 'USB-C Hub Anker', 45000.00, 'Accessories', TRUE),
('b8c9d0e1-f2a3-4b4c-5d6e-7f8a9b0c1d2e', 'External HDD 2TB', 70000.00, 'Storage', TRUE),
('c9d0e1f2-a3b4-4c5d-6e7f-8a9b0c1d2e3f', 'Gaming Chair', 180000.00, 'Furniture', TRUE),
('d0e1f2a3-b4c5-4d6e-7f8a-9b0c1d2e3f4a', 'Desk Lamp LED', 35000.00, 'Office', FALSE);


INSERT INTO orders (id, user_id, order_date, total) VALUES
-- March 2024
('6df4508e-44f0-45b0-a027-7141a44a80ea', '5d13be14-bc74-49fe-9b26-1fbcfe15243a', '2024-03-01', 3620000.00),
('33fcb2a9-2c05-45fc-946f-cf54a938039a', '5d13be14-bc74-49fe-9b26-1fbcfe15243a', '2024-03-10', 120000.00),
('308b2c76-2a59-47e0-86f8-ba8fd5955c8f', 'ad5e4b9a-68a9-40b3-8ee1-8745da1af7b9', '2024-03-05', 950000.00),
('d02cd9c0-2e58-4805-9edd-5dd28ce14e06', 'ad5e4b9a-68a9-40b3-8ee1-8745da1af7b9', '2024-03-20', 3500000.00),
('7eda3ade-66cc-4e31-90a5-fe71039643f3', '9e6bbb50-d8d3-4ac3-80f2-8cd719b2cab1', '2024-03-25', 170000.00),
('b21bce00-f670-4115-97d9-2bc824d2185c', '9e6bbb50-d8d3-4ac3-80f2-8cd719b2cab1', '2024-03-28', 50000.00),
('f3e1d1c2-1111-4aaa-9bbb-123456789001', '9e6bbb50-d8d3-4ac3-80f2-8cd719b2cab1', '2024-03-29', 800000.00),
('f3e1d1c2-2222-4bbb-9ccc-123456789002', '5d13be14-bc74-49fe-9b26-1fbcfe15243a', '2024-03-30', 200000.00),
-- April 2024
('a1a1a1a1-1111-4444-8888-111111111111', '7f8e9d10-4c5b-4a3d-9e2f-1a2b3c4d5e6f', '2024-04-02', 750000.00),
('b2b2b2b2-2222-4444-8888-222222222222', '8a9b0c11-5d6e-4b4f-0f3a-2b3c4d5e6f7a', '2024-04-05', 1200000.00),
('c3c3c3c3-3333-4444-8888-333333333333', '9b0c1d12-6e7f-4c5a-1a4b-3c4d5e6f7a8b', '2024-04-08', 450000.00),
('d4d4d4d4-4444-4444-8888-444444444444', '0c1d2e13-7f8a-4d6b-2b5c-4d5e6f7a8b9c', '2024-04-12', 3850000.00),
('e5e5e5e5-5555-4444-8888-555555555555', '1d2e3f14-8a9b-4e7c-3c6d-5e6f7a8b9c0d', '2024-04-15', 680000.00),
('f6f6f6f6-6666-4444-8888-666666666666', '5d13be14-bc74-49fe-9b26-1fbcfe15243a', '2024-04-18', 95000.00),
('a7a7a7a7-7777-4444-8888-777777777777', 'ad5e4b9a-68a9-40b3-8ee1-8745da1af7b9', '2024-04-20', 330000.00),
('b8b8b8b8-8888-4444-8888-888888888888', '9e6bbb50-d8d3-4ac3-80f2-8cd719b2cab1', '2024-04-22', 550000.00),
('c9c9c9c9-9999-4444-8888-999999999999', '7f8e9d10-4c5b-4a3d-9e2f-1a2b3c4d5e6f', '2024-04-25', 140000.00),
('d0d0d0d0-0000-4444-8888-000000000000', '8a9b0c11-5d6e-4b4f-0f3a-2b3c4d5e6f7a', '2024-04-28', 900000.00),
-- May 2024
('e1e1e1e1-1111-5555-9999-111111111111', '9b0c1d12-6e7f-4c5a-1a4b-3c4d5e6f7a8b', '2024-05-03', 280000.00),
('f2f2f2f2-2222-5555-9999-222222222222', '0c1d2e13-7f8a-4d6b-2b5c-4d5e6f7a8b9c', '2024-05-06', 550000.00),
('a3a3a3a3-3333-5555-9999-333333333333', '1d2e3f14-8a9b-4e7c-3c6d-5e6f7a8b9c0d', '2024-05-10', 1750000.00),
('b4b4b4b4-4444-5555-9999-444444444444', '5d13be14-bc74-49fe-9b26-1fbcfe15243a', '2024-05-12', 230000.00),
('c5c5c5c5-5555-5555-9999-555555555555', 'ad5e4b9a-68a9-40b3-8ee1-8745da1af7b9', '2024-05-15', 4300000.00),
('d6d6d6d6-6666-5555-9999-666666666666', '9e6bbb50-d8d3-4ac3-80f2-8cd719b2cab1', '2024-05-18', 115000.00),
('e7e7e7e7-7777-5555-9999-777777777777', '7f8e9d10-4c5b-4a3d-9e2f-1a2b3c4d5e6f', '2024-05-20', 600000.00),
('f8f8f8f8-8888-5555-9999-888888888888', '8a9b0c11-5d6e-4b4f-0f3a-2b3c4d5e6f7a', '2024-05-23', 80000.00),
('a9a9a9a9-9999-5555-9999-999999999999', '9b0c1d12-6e7f-4c5a-1a4b-3c4d5e6f7a8b', '2024-05-26', 370000.00),
('b0b0b0b0-0000-5555-9999-000000000000', '0c1d2e13-7f8a-4d6b-2b5c-4d5e6f7a8b9c', '2024-05-29', 925000.00),
-- June 2024
('c1c1c1c1-1111-6666-0000-111111111111', '1d2e3f14-8a9b-4e7c-3c6d-5e6f7a8b9c0d', '2024-06-01', 3650000.00),
('d2d2d2d2-2222-6666-0000-222222222222', '5d13be14-bc74-49fe-9b26-1fbcfe15243a', '2024-06-05', 180000.00),
('e3e3e3e3-3333-6666-0000-333333333333', 'ad5e4b9a-68a9-40b3-8ee1-8745da1af7b9', '2024-06-08', 500000.00),
('f4f4f4f4-4444-6666-0000-444444444444', '9e6bbb50-d8d3-4ac3-80f2-8cd719b2cab1', '2024-06-12', 95000.00),
('a5a5a5a5-5555-6666-0000-555555555555', '7f8e9d10-4c5b-4a3d-9e2f-1a2b3c4d5e6f', '2024-06-15', 1450000.00),
('b6b6b6b6-6666-6666-0000-666666666666', '8a9b0c11-5d6e-4b4f-0f3a-2b3c4d5e6f7a', '2024-06-18', 310000.00),
('c7c7c7c7-7777-6666-0000-777777777777', '9b0c1d12-6e7f-4c5a-1a4b-3c4d5e6f7a8b', '2024-06-20', 730000.00),
('d8d8d8d8-8888-6666-0000-888888888888', '0c1d2e13-7f8a-4d6b-2b5c-4d5e6f7a8b9c', '2024-06-23', 200000.00),
('e9e9e9e9-9999-6666-0000-999999999999', '1d2e3f14-8a9b-4e7c-3c6d-5e6f7a8b9c0d', '2024-06-26', 850000.00),
('f0f0f0f0-0000-6666-0000-000000000000', '5d13be14-bc74-49fe-9b26-1fbcfe15243a', '2024-06-28', 60000.00),
-- Some duplicate orders on same day for testing
('aaaa1111-bbbb-cccc-dddd-eeeeeeee1111', '5d13be14-bc74-49fe-9b26-1fbcfe15243a', '2024-06-28', 120000.00),
('aaaa2222-bbbb-cccc-dddd-eeeeeeee2222', '9e6bbb50-d8d3-4ac3-80f2-8cd719b2cab1', '2024-05-18', 50000.00);



INSERT INTO order_items (order_id, product_id, quantity, unit_price) VALUES
-- March Orders
('6df4508e-44f0-45b0-a027-7141a44a80ea', 'f660296f-5582-4d8a-b8d5-f3e3250e9e6e', 1, 3500000.00),
('6df4508e-44f0-45b0-a027-7141a44a80ea', '5cb3e058-1336-47a5-bf79-585742de7db7', 2, 50000.00),
('6df4508e-44f0-45b0-a027-7141a44a80ea', '5cb3e058-1336-47a5-bf79-585742de7db7', 1, 50000.00), -- Duplicate product in same order
('33fcb2a9-2c05-45fc-946f-cf54a938039a', '97068931-4d44-4fe8-a2fe-6351e135dc3c', 1, 120000.00),
('308b2c76-2a59-47e0-86f8-ba8fd5955c8f', '469f9f98-8905-4ea6-8f58-cb94ed5cdb69', 1, 900000.00),
('d02cd9c0-2e58-4805-9edd-5dd28ce14e06', 'f660296f-5582-4d8a-b8d5-f3e3250e9e6e', 1, 3500000.00),
('d02cd9c0-2e58-4805-9edd-5dd28ce14e06', '5cb3e058-1336-47a5-bf79-585742de7db7', 3, 40000.00), -- Different price
('7eda3ade-66cc-4e31-90a5-fe71039643f3', 'e557ec40-55d4-485e-8d2b-b051d5c26d3b', 1, 150000.00),
('b21bce00-f670-4115-97d9-2bc824d2185c', '5cb3e058-1336-47a5-bf79-585742de7db7', 1, 50000.00),
('f3e1d1c2-1111-4aaa-9bbb-123456789001', '469f9f98-8905-4ea6-8f58-cb94ed5cdb69', 1, 850000.00), -- Different price
('f3e1d1c2-2222-4bbb-9ccc-123456789002', '97068931-4d44-4fe8-a2fe-6351e135dc3c', 2, 100000.00), -- Different price

-- April Orders
('a1a1a1a1-1111-4444-8888-111111111111', 'c3d4e5f6-a7b8-4c9d-0e1f-2a3b4c5d6e7f', 1, 550000.00),
('a1a1a1a1-1111-4444-8888-111111111111', 'd4e5f6a7-b8c9-4d0e-1f2a-3b4c5d6e7f8a', 1, 200000.00),
('b2b2b2b2-2222-4444-8888-222222222222', 'f660296f-5582-4d8a-b8d5-f3e3250e9e6e', 1, 3500000.00),
('b2b2b2b2-2222-4444-8888-222222222222', 'a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d', 2, 80000.00),
('b2b2b2b2-2222-4444-8888-222222222222', 'f6a7b8c9-d0e1-4f2a-3b4c-5d6e7f8a9b0c', 1, 95000.00),
('c3c3c3c3-3333-4444-8888-333333333333', 'b2c3d4e5-f6a7-4b8c-9d0e-1f2a3b4c5d6e', 1, 250000.00),
('c3c3c3c3-3333-4444-8888-333333333333', 'd4e5f6a7-b8c9-4d0e-1f2a-3b4c5d6e7f8a', 1, 200000.00),
('d4d4d4d4-4444-4444-8888-444444444444', 'f660296f-5582-4d8a-b8d5-f3e3250e9e6e', 1, 3500000.00),
('d4d4d4d4-4444-4444-8888-444444444444', 'e557ec40-55d4-485e-8d2b-b051d5c26d3b', 1, 150000.00),
('d4d4d4d4-4444-4444-8888-444444444444', 'd4e5f6a7-b8c9-4d0e-1f2a-3b4c5d6e7f8a', 1, 200000.00),
('e5e5e5e5-5555-4444-8888-555555555555', 'c3d4e5f6-a7b8-4c9d-0e1f-2a3b4c5d6e7f', 1, 550000.00),
('e5e5e5e5-5555-4444-8888-555555555555', 'a7b8c9d0-e1f2-4a3b-4c5d-6e7f8a9b0c1d', 2, 45000.00),
('e5e5e5e5-5555-4444-8888-555555555555', 'e5f6a7b8-c9d0-4e1f-2a3b-4c5d6e7f8a9b', 1, 60000.00),
('f6f6f6f6-6666-4444-8888-666666666666', 'f6a7b8c9-d0e1-4f2a-3b4c-5d6e7f8a9b0c', 1, 95000.00),
('a7a7a7a7-7777-4444-8888-777777777777', 'b2c3d4e5-f6a7-4b8c-9d0e-1f2a3b4c5d6e', 1, 250000.00),
('a7a7a7a7-7777-4444-8888-777777777777', 'a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d', 1, 80000.00),
('b8b8b8b8-8888-4444-8888-888888888888', 'c3d4e5f6-a7b8-4c9d-0e1f-2a3b4c5d6e7f', 1, 550000.00),
('c9c9c9c9-9999-4444-8888-999999999999', '97068931-4d44-4fe8-a2fe-6351e135dc3c', 1, 120000.00),
('d0d0d0d0-0000-4444-8888-000000000000', '469f9f98-8905-4ea6-8f58-cb94ed5cdb69', 1, 900000.00),

-- May Orders
('e1e1e1e1-1111-5555-9999-111111111111', 'b2c3d4e5-f6a7-4b8c-9d0e-1f2a3b4c5d6e', 1, 250000.00),
('e1e1e1e1-1111-5555-9999-111111111111', 'd0e1f2a3-b4c5-4d6e-7f8a-9b0c1d2e3f4a', 1, 35000.00), -- Inactive product
('f2f2f2f2-2222-5555-9999-222222222222', 'c3d4e5f6-a7b8-4c9d-0e1f-2a3b4c5d6e7f', 1, 550000.00),
('a3a3a3a3-3333-5555-9999-333333333333', '469f9f98-8905-4ea6-8f58-cb94ed5cdb69', 1, 900000.00),
('a3a3a3a3-3333-5555-9999-333333333333', '469f9f98-8905-4ea6-8f58-cb94ed5cdb69', 1, 850000.00), -- Same product, different price, duplicate
('b4b4b4b4-4444-5555-9999-444444444444', 'e557ec40-55d4-485e-8d2b-b051d5c26d3b', 1, 150000.00),
('b4b4b4b4-4444-5555-9999-444444444444', 'a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d', 1, 80000.00),
('c5c5c5c5-5555-5555-9999-555555555555', 'f660296f-5582-4d8a-b8d5-f3e3250e9e6e', 1, 3500000.00),
('c5c5c5c5-5555-5555-9999-555555555555', '469f9f98-8905-4ea6-8f58-cb94ed5cdb69', 1, 900000.00),
('d6d6d6d6-6666-5555-9999-666666666666', 'e5f6a7b8-c9d0-4e1f-2a3b-4c5d6e7f8a9b', 1, 60000.00),
('d6d6d6d6-6666-5555-9999-666666666666', '5cb3e058-1336-47a5-bf79-585742de7db7', 1, 50000.00),
('e7e7e7e7-7777-5555-9999-777777777777', 'e5f6a7b8-c9d0-4e1f-2a3b-4c5d6e7f8a9b', 10, 60000.00),
('f8f8f8f8-8888-5555-9999-888888888888', 'a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d', 1, 80000.00),
('a9a9a9a9-9999-5555-9999-999999999999', 'c9d0e1f2-a3b4-4c5d-6e7f-8a9b0c1d2e3f', 2, 180000.00),
('b0b0b0b0-0000-5555-9999-000000000000', '469f9f98-8905-4ea6-8f58-cb94ed5cdb69', 1, 900000.00),

-- June Orders
('c1c1c1c1-1111-6666-0000-111111111111', 'f660296f-5582-4d8a-b8d5-f3e3250e9e6e', 1, 3500000.00),
('c1c1c1c1-1111-6666-0000-111111111111', 'e557ec40-55d4-485e-8d2b-b051d5c26d3b', 1, 150000.00),
('d2d2d2d2-2222-6666-0000-222222222222', 'c9d0e1f2-a3b4-4c5d-6e7f-8a9b0c1d2e3f', 1, 180000.00),
('e3e3e3e3-3333-6666-0000-333333333333', 'c3d4e5f6-a7b8-4c9d-0e1f-2a3b4c5d6e7f', 1, 500000.00), -- Price variance
('f4f4f4f4-4444-6666-0000-444444444444', 'f6a7b8c9-d0e1-4f2a-3b4c-5d6e7f8a9b0c', 1, 95000.00),
('a5a5a5a5-5555-6666-0000-555555555555', '469f9f98-8905-4ea6-8f58-cb94ed5cdb69', 1, 900000.00),
('a5a5a5a5-5555-6666-0000-555555555555', 'c3d4e5f6-a7b8-4c9d-0e1f-2a3b4c5d6e7f', 1, 550000.00),
('b6b6b6b6-6666-6666-0000-666666666666', 'b2c3d4e5-f6a7-4b8c-9d0e-1f2a3b4c5d6e', 1, 250000.00),
('b6b6b6b6-6666-6666-0000-666666666666', 'e5f6a7b8-c9d0-4e1f-2a3b-4c5d6e7f8a9b', 1, 60000.00),
('c7c7c7c7-7777-6666-0000-777777777777', 'b8c9d0e1-f2a3-4b4c-5d6e-7f8a9b0c1d2e', 10, 70000.00),
('c7c7c7c7-7777-6666-0000-777777777777', 'e5f6a7b8-c9d0-4e1f-2a3b-4c5d6e7f8a9b', 1, 60000.00),
('d8d8d8d8-8888-6666-0000-888888888888', 'd4e5f6a7-b8c9-4d0e-1f2a-3b4c5d6e7f8a', 1, 200000.00),
('e9e9e9e9-9999-6666-0000-999999999999', '469f9f98-8905-4ea6-8f58-cb94ed5cdb69', 1, 850000.00), -- Price variance
('f0f0f0f0-0000-6666-0000-000000000000', 'e5f6a7b8-c9d0-4e1f-2a3b-4c5d6e7f8a9b', 1, 60000.00),
('aaaa1111-bbbb-cccc-dddd-eeeeeeee1111', '97068931-4d44-4fe8-a2fe-6351e135dc3c', 1, 120000.00),
('aaaa2222-bbbb-cccc-dddd-eeeeeeee2222', '5cb3e058-1336-47a5-bf79-585742de7db7', 1, 50000.00);

 
SELECT SUM(total) AS total_revenue
FROM orders;

--FORMA 2



SELECT 
    u.name,
    u.email,
    SUM(o.total) AS valor
FROM users u
JOIN orders o ON u.id = o.user_id
GROUP BY u.id, u.name, u.email
ORDER BY valor DESC;



SELECT 
    u.name,
    COUNT(o.id) AS number_of_orders
FROM users u
LEFT JOIN orders o ON u.id = o.user_id
GROUP BY u.id, u.name
ORDER BY number_of_orders DESC;




SELECT AVG(total) 
FROM orders;


SELECT 
    o.id AS order_id,
    u.name AS user_name,
    COUNT(oi.product_id) AS number_of_products
FROM orders o
JOIN users u ON o.user_id = u.id
JOIN order_items oi ON o.id = oi.order_id
GROUP BY o.id, u.name
HAVING COUNT(oi.product_id) > 1
ORDER BY number_of_products DESC;

